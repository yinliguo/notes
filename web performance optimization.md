# web性能优化

## Content
### 1. 减少http请求
- 合并静态资源文件。包括合并js、css，生成雪碧图
- 小图片使用base64编码。缺点1：IE8最大支持32K的图片；缺点2：不缓存；缺点3：不宜用于大图片

### 2. 减少DNS查询
- 

### 3. 避免跳转
- 301：永久转移；302：临时性转移

### 4. 缓存ajax
- 在header中设置expires或Cache-Control

### 5. 延迟加载组件
- 一些js可以放到onload事件之后执行

### 6. 预加载组件
- 在浏览器空闲事件请求将来会用到的组件

### 7. 减少DOM数量

### 8. 把组件分散到不同的域名
- 实现最大程度的并行下载，应尽量多得使用不同的域名，但域名多的话又会增加域名解析时间，因此推荐2-4个不同的域名

### 9. 减少iframe
- iframe的优点：1、帮助解决缓慢的第三方内容的加载，如广告和徽章（没看懂）；2、安全沙盒；3、并行下载脚本
- iframe的缺点：1、即使空的也消耗资源和时间；2、阻塞了页面的onload；3、非语义化标签

### 10. 不要使用404
- http请求是昂贵的，不要返回没用的信息

## Server

### 1. 使用CDN

### 2. 增加缓存头信息
- 加上expires或Cache-Control

### 3. 使用Gzip压缩组件
- 客户端可以通过设置Accept-Encoding: gzip, deflate来提示支持的压缩方式
- 应该gzip更多的文本类型的文件，如html、脚本、样式、xml、json等，而图片、pdf不应该被gzip，因为它们本身是被压缩过的，再进行压缩就是浪费CPU

### 4. 配置Etags
- Etags是判断浏览器缓存的某个组件与原服务器的组件是否一致的机制。服务器设置了Etags，如果浏览器要验证该组件，可以发送If-None-Match，如果相同，则服务器返回304。但有个问题就是，Etags要保证服务器的唯一性，如果从A服务器获取了Etags，再向B服务器请求验证相同的资源就会不匹配，解决方案是服务器集群

### 5. 尽早刷新buffer（尽早给浏览器数据）
- 在php中有个flush方法，可以将部分准备好的html发送给浏览器，这样浏览器就可以下载组件，而后台继续生成页面的剩余部分。比较好的位置就是讲flush放在head之后
```
<!-- 静态资源 -->
</head>
flush()
<body>
```

### 6. ajax请求用GET
- POST请求被浏览器分成两步，首先发送头部，然后发送数据。（个人认为但还是应该按照各个方法的使用方式来使用）

### 7. 避免空src的图片
- 因为它们会向服务器发送请求，消耗流量和服务器资源

## Cookie

### 1. 减小cookie的大小
- 减小cookie的大小
- 设置设置的cookie的域名级别

### 2. 使用没有cookie的域名提供组件
- 当请求静态资源（如js、css、图片）时，cookie对于服务器来说是没用的，增加了没用的流量，可以使用一个子域名来托管所有的静态组件

## CSS
### 1. 将样式放在顶部
- 将样式放在head中来允许浏览器逐步渲染

### 2. 避免使用CSS表达式
- CSS表达式的问题在于计算非常频繁，不仅页面载入和调整大小时计算，而且在滚动页面和移动鼠标时也计算

### 3. 使用link引入CSS而非@import
- 原因在于放在head中来允许逐步渲染

### 4. 避免使用IE过滤器
- IE专有的AlphaImageLoader过滤器用来修复IE7以下版本的半透明真彩色的PNG的问题。这个过滤器的问题在于它阻止了渲染，并在图片下载时冻结了浏览器，另外还引起内存消耗，并且被应用到每个元素而非每个图片，所以性能问题就更严重了。最佳做法是使用PNG8来优雅降级

## JavaScript
### 1. 将javascript放到底部
- 脚本引起的问题在于阻塞并行下载。如果图片分布在不同的服务器上，可以并行下载，但是当浏览器在下载脚本时，就不会下载其它组件了，即使在不同的域名下。

### 2. 使用外部的js和css
- 外部的js和css可以被缓存起来，如果内联不但会造成html增大，而且不会缓存

### 3. 压缩js和css
- 压缩和混淆

### 4. 移除重复的脚本

### 5. 减少DOM操作
- 用js操作DOM是缓慢的，应该1、缓存访问过的DOM的元素；2、在DOM树外更新节点，然后插入到DOM树中；3、避免js实现固定布局

### 6. 使用更好的事件处理方式
- 例如事件委托

## Images
### 1. 优化图片
- 将gif转成png8看看有没有变小
- 使用pngcrush或其他工具来压缩png
- 使用jpegtran或其他工具来压缩jpeg

### 2. 雪碧图
- 把图片横向合并更小
- 把颜色相近的合并到一起，如果低于256就可以用png8
- 合并图片的间距不要太大，对图片的大小影响不大，但需要更多的内存进行解压

### 3. 不要在html中缩放图片
- 100×100px的img不要使用500×500px的进行缩放

### 4. favicon小且可缓存
- 浏览器总是会请求favicon.ico，所以尽量保证小，最好在1K以下，且缓存设置为几个月

## Mobile
### 1. 保持组件小于25k
- 因为iphone不缓存大于25k的组件，而且这是非gzip的大小，iphone没有实现gzip

### 2. 打包组件到一个多部父文档（没看懂）